                           ГЛАВА 2

                     О РЕСУРСАХ И ФАЙЛАХ

     Эта глава предоставляет обзор ресурсов и файлов,  с кото-
рыми можно  работать  в Resource Toolkit.  Она также описывает
как использовать файлы для разработки ресурсов  Windows  прог-
раммы.
     Примечание. Информация по каждому редактору   приведена в
главах 4 - 9.

                      Что такое ресурс?

     Можно представить ресурс как отдельный файл данных, кото-
рый добавляется к выполнимому файлу. Пока ресурс правильно оп-
ределен, специфическая  информация  о  нем может быть изменена
без воздействия на программу.
     Windows программы  состоят  из множества различных графи-
ческих элементов. Например, одна программа может иметь 10 раз-
личных курсоров  мышки,  представляющих  различные действующие
режимы. Вместо того, чтобы явно хранить информацию о курсоре в
программе, можно хранить ее отдельно в качестве ресурса, кото-
рый загружается в программу по мере необходимости. Преимущест-
ва отдельных ресурсов при таком способе состоит в следующем:
     - Это  облегчает  использование  одинаковых   определений
ресурсов для нескольких программ.
     - Визуальное представление  программы  можно  модифициро-
вать, не  изменяя,  или  даже,  не  обращаясь к исходному коду
программы.
     Ресурсы являются  данными,  делящимися  по  типу - растр,
курсор, диалоговое окно и т.д. - и им присваивается уникальное
имя или  номер внутри этого типа.  Данные могут быть любой ин-
формацией, относящейся к данному ресурсу. Например, ресурс ди-
алогового окна  может  содержать  данные,  представляющие  три
кнопки, метки кнопок и где эти кнопки должны рисоваться на эк-
ране.
     Ресурсы описывают  визуальные  характеристики   элементов
программы. Они не определяют  функции; фактически, изменение в
ресурсах не влияет на функциональный код.  Когда ресурсы отде-
ляются от исходного кода,  ими можно манипулировать независимо
друг от друга.  Это означает,  что можно использовать Resource
Toolkit, чтобы изменить вид Windows программ без необходимости
обращаться к исходному коду.
     Примечание. Можно создать или отредактировать большинство
типов ресурсов, используя Windows программы. См. ниже.
     Resource Toolkit позволяет просматривать,  редактировать,
наблюдать, копировать  и  удалять  определенные   ресурсы.   К
ресурсам, которые можно копировать, переименовывать и удалять,
но нельзя редактировать или просматривать, относятся:
     - Шрифты. Шрифты программы используют для вывода текста на
дисплей.
     - .RC файлы данных. Ресурсы необработанных данных.
     - Ресурсы,  определенные пользователем. Любые данные, ко-
торые нужно добавлять к выполнимому файлу.
     В следующем разделе описаны ресурсы, которые можно редак-
тировать, просматривать, копировать и удалять.

                    Редактируемые ресурсы

     Этот раздел описывает типы ресурсов, которые можно редак-
тировать в Resource Toolkit. К ним относятся:
     акселераторы               диалоговые окна
     растры                     меню
     курсоры                    строки
     пиктограммы

                         Акселераторы

     Акселераторы часто называются сокращенными или "горячими"
клавишами. Акселератор - это клавиша или комбинация клавиш, на
которую можно нажать в качестве альтернативного способа выбора
элемента меню  для  вызова  команды.  Акселераторы увеличивают
скорость и удобства использования программы. Например, быстрее
нажать Shift-Ins, чем вытолкнуть Edit меню и выбрать Paste.
     Редактор акселераторов позволяет определить акселераторы,
нажав на клавишу(и), которую(ые) нужно заменить для каждой оп-
ределенной опции меню.  Затем акселератор можно  идентифициро-
вать в меню, как альтернативный способ для вызова операций ме-
ню.
                            Растры

     Растр - это тело данных, которые программа использует для
вывода на экран изображения. Растр может иметь любое измерение
и может  состоять из нескольких цветов.  Растр может заполнять
все окно (как в Windows настольном изображении),или  покрывать
только небольшую область (как в курсоре).
     Редактор растров представляет собой сложное средство  ре-
дактирования,   которое  делает  мощные  возможности  типичной
рисующей программы  задачей  редактирования  цветных  растров.
Этот редактор  обеспечивает различные средства для изображения
линий и фигур, а также для заполнения областей, функций выбора
и перемещения.

                           Курсоры

     Курсор представляет собой маркер, используемый для выбора
графических элементов на экране  или  для  размещения  позиции
вставки при вводе.  Ресурс курсора - это специальный тип раст-
ра, который ограничен специальным  измерением  32x32  пиксела.
Так как  курсор используется для указания на экране определен-
ной точки,  он  имеет  возможность   определить   единственный
пиксел, который отображается в точную позицию на экране.  Этот
пиксел называется "горячей ячейкой".  Для программ можно опре-
делять курсоры различной формы.
     Ресурсы курсора содержат данные для двух  растров:  один,
описывающий цвет курсора в каждой точке, а другой, описывающий
то, как курсор должен появляться  на  существующем  фоне.  Это
позволяет курсорам    демонстрировать   некоторые   интересные
свойства. Например,  части курсора можно сделать  скрытыми  на
экране или можно изменить цвет фоновый цвет курсора.
     Редактор курсоров  -  это  специальная  версия  редактора
растров. Он предоставляет несколько сложных средств, также как
и редактор растров,  но эти средства предназначены для  специ-
альных потребностей редактирования курсоров.

                         Пиктограммы

     Пиктограмма представляет  собой графический экранный эле-
мент, который можно выбрать для изменения состояния прикладной
программы. Например,  чтобы начать работу Resource Toolkit, Вы
нажимаете на его пиктограмму с помощью мышки в Windows Program
Manager.
     Ресурс пиктограмм - это другой тип  специального  растра.
Подобно курсору, пиктограмма может определять различные комби-
нации цветов переднего плана с фоновыми  цветами,  поэтому  ее
внешний вид может изменяться по мере перемещения по экрану.
     Редактор пиктограмм - это еще одна специальная версия ре-
дактора растров,  на этот раз предназначенная для потребностей
редактирования пиктограмм.

                       Диалоговые окна

     Диалоговое окно - это экран ввода,  который позволяет вы-
бирать различные  опции в программе.  Чтобы сделать выбор,  Вы
манипулируете графическими элементами, называемыми управления-
ми в  диалоговом окне.  Управления представляют собой знакомые
приемы, которые  облегчают использование  окон: например, окна
списков, линейки прокрутки, поля ввода.
     Ресурс диалогового окна - это сложное  множество  данных,
описывающих свойства диалогового окна и его управлений. К этим
свойствам относятся:  размер ресурсов,  расположение экрана  и
метки текста.
     Редактор диалогового окна позволяет создавать  диалоговые
окна с помощью мышки. Таким образом, Вы видите диалоговое окно
так, как оно будет появляться в программе.  Редактор  включает
средства для изображения окна, а также управления для вставки,
изменения размера и перемещения диалогового окна.

                             Меню

     Меню перечисляет допустимые опции программы, которые мож-
но активизировать.  Когда  Вы выбрали из списка опцию,  то или
выполняется действие,  или открывается другое  меню  для  пре-
доставления дополнительных  опций.  Ресурс меню идентифицирует
допустимые опции и определяет порядок, в котором эти опции пе-
речисляются.
     Редактор меню представляет собой сложный редактор для оп-
ределения ресурсов меню. Он позволяет визуально конструировать
новые спускающиеся меню, настраивать их внешний вид и интерак-
тивно проверять их во время сеанса редактирования.

                            Строки

     Строки представляют собой текст,  который программа выво-
дит в меню,  диалоговых окнах,  сообщениях об ошибках  и  т.д.
Можно определить  текст строки в исходном коде программы или в
качестве отдельного ресурса,  который загружается в  программу
по мере необходимости.
     Если Вы определяете строки как ресурсы,  то можно сделать
Вашу программу долее гибкой и  сэкономить Вашу работу несколь-
кими способами. Например,
     - Определение строк в качестве ресурса облегчает настрой-
ку программы для использования в другой стране.  Это  возможно
потому, что  Resource Toolkit можно потом использовать для пе-
ревода строк с одного языка на другой (с английского,  скажем,
на французский) без необходимости обращаться к исходному коду.
     - Определение строк в качестве ресурсов  облегчает  также
усовершенствование и редактирование сообщений программы.  Нап-
ример, если программа имеет двусмысленные или запутанные сооб-
щения, то  эти  сообщения  можно  прояснить,  редактируя соот-
ветствующий текст строк. Это можно сделать , не изменяя исход-
ный код программы.
     Редактор строк позволяет легко создавать и  редактировать
ресурсы строк.

       Файлы, которые можно редактировать или сохранять

     Можно использовать  Resource Toolkit для создания или ре-
дактирования большинства типов файлов  ресурсов,  используемых
Windows программами.  Кроме того, так как выполнимые файлы мо-
гут содержать ресурсы,  также как и  исходный  код,  то  можно
использовать Resource  Toolkit для редактирования ресурсов вы-
полнимых файлов,  даже если у Вас нет исходного кода.  В  этом
разделе кратко описываются типы файлов, которые можно редакти-
ровать или сохранять в Resource Toolkit.
     Таблица 2.1 показывает типы файлов,  которые можно редак-
тировать в Resource Toolkit.
    Таблица 2.1  Файлы  ,  которые  можно   редактировать
                      в Resource Toolkit
──────────────────────────────────────────────────────────────
     Файл      Тип          Описание
──────────────────────────────────────────────────────────────
     .EXE     выполнимый   Выполнимый файл, содержащий ресур-
                           сы  программы  и откомпилированный
                           код программы.
     .RES     ресурс       Откомпилированный файл ресурсов.
     .DLL     выполнимый   Выполнимый  модуль, содержащий ре-
                           сурсы программы и  откомпилирован-
                           ный код программы.
     .H       исходный     Файл заголовков, содержащий симво-
              код          лические имена  для  определенных
                           ресурсов.
     .ICO     ресурс       Файл ресурса пиктограммы.
     .CUR     ресурс       Файл ресурса курсора.
     .BMP     ресурс       Файл ресурса растра.
──────────────────────────────────────────────────────────────
     Примечание. .ICO, .CUR, .BMP файлы каждый может содержать
только один ресурс.
     Таблица 2.2 показывает типы файлов, которые могут генери-
роваться Resource Toolkit,  но которые должны  компилироваться
Microsoft Resource Compiler, чтобы создать .RES или .EXE файлы
для редактирования.
       Таблица 2.2 Файлы,  которые могут генерироваться
                       Resource Toolkit
──────────────────────────────────────────────────────────────
     Файл      Тип          Описание
──────────────────────────────────────────────────────────────
     .DLG     описание     Файл описания  ресурса  диалогового
              ресурса      окна..DLG файл,генерируемый Resour-
                           ce Toolkit,может содержать описание
                           только для одного диалогового  окна
                           в текстовом формате.
     .RC      описание     Файл описания  ресурсов. Этот  файл
              ресурса      создается ASCII  редактором; он со-
                           держит список всех  ресурсов, опре-
                           деленных в программе.
──────────────────────────────────────────────────────────────
     Файлы ресурсов некоторых типов можно копировать, переиме-
новывать или удалять,  но нельзя создавать,  просматривать или
редактировать в Resource Toolkit.
──────────────────────────────────────────────────────────────
     Файл      Тип          Описание
──────────────────────────────────────────────────────────────
     .FON     ресурс       Шрифты, которые  программа  исполь-
                           зует для изображения текста.
     .DAT     ресурс       Ресурсы необработанных данных.
──────────────────────────────────────────────────────────────
     Resource Toolkit  может сохранять ресурсы непосредственно
в .RES и/или .EXE файлах.  Это  означает,  что  Вам  не  нужен
Microsofr Resource Compiler ,  чтобы компилировать ресурсы, но
Вам необходим  компилятор,  чтобы  добавить  откомпилированные
ресурсы в .EXE файл.
     С помощью  Resource  Toolkit  разработка   ресурсов   для
Windows программ является  прямой:
     1. Создается первый ресурс программы и сохраняется в  но-
вом .RES файле.
     2. Создаются все дополнительные ресурсы,  которые необхо-
димы программе и сохраняются в том же .RES файле.
     3. После  того,  как  все  ресурсы  будут  определены   в
.RES файле, они копируются в .EXE файл программы.
     Примечание. Так как  Resource  Toolkit  может  записывать
ресурсы непосредственно в .EXE файл,  Вы можете удивиться, по-
чему нельзя удалить .RES файл. Причина в том, что редактирова-
ние .EXE файла с Windows и С/С++ библиотеками времени выполне-
ния удаляет все ресурсы из .EXE файла. (Turbo Pascal автомати-
чески связывает ресурсы на фазе редактирования связей; ресурсы
должны быть в .RES файле).  Если ресурсы хранятся  отдельно  в
.RES файле,  то  всегда  можно  добавить их к .EXE файлу после
повторного редактирование связей.
     Этот процесс,  изображенный  на  рисунке  2.1,  исключает
несколько этапов,  которые Вы в противном случае должны выпол-
нить для создания ресурсов Вашей программы. Это происходит по-
тому, что Вам не нужно создавать .RC  и  .DLG  файлы  описания
ресурсов и Вам не нужен .RC компилятор.
           Рисунок 2.1 Построение Windows программ
                      в Resource Toolkit
             ┌──────┐          ┌───────────┐
       .EXE  │ CODE │          │ RESOURCES │  .RES
             └──┬───┘          └────────┬──┘
                │                       │
                │                       │
                │                       │
                │     ┌───────────┐     │
                └────>┤ RESOURCE  ├<────┘
                      │  TOOLKIT  │
                      └─────┬─────┘
                            │
                            │
                      ┌─────┴──────┐
                      │  CODE      │
                      ├────────────┤.EXE с ресурсами
                      │  RESOURCES │
                      └────────────┘

                       Выполнимые файлы

     Выполнимый (.EXE)  файл  содержит  все  ресурсы программы
плюс откомпилированный код программы.  Это означает,  что .EXE
файлы хранят все типы ресурсов. Можно непосредственно редакти-
ровать ресурсы  в  .EXE  файле  и  сохранять  модифицированные
ресурсы опять  в  этом  же  файле.  Это полезно для выполнения
косметических изменений в программах,  даже  если  у  Вас  нет
исходного кода. Например, Можно изменить пиктограмму программы
или разделить сложное всплывающее меню в программе на два  или
несколько более простых иерархических меню.

                        Файлы ресурсов

     Файлы ресурсов  (.RES)  содержат любой тип или комбинацию
ресурсов в двоичном формате.  Можно непосредственно редактиро-
вать .RES  файлы в Resource Toolkit и сохранять модифицирован-
ные ресурсы опять в  этом  же  файле.  Можно  также  сохранить
ресурс в  новом .RES файле.  Обычно Вы создаете один .RES файл
для каждой программы и храните все ресурсы в этом файле.

        Библиотеки динамического редактирования связей

     Библиотека динамического редактирования связей  (.DLL)  -
это выполнимый модуль,  содержащий ресурсы и функции,  которые
можно вызвать с помощью Windows программ.  DLL подобна библио-
теке времени выполнения, за исключением того, что она связыва-
ется с программой во время выполнения,  а не в то время, когда
связываются условные  файлы  программ.  Библиотека активизиру-
ется, когда другой модуль вызывает одну из ее функций.  Комби-
нирование обычно  используемых  в DLL программ позволяет иметь
доступ к ним многим программам;  они не должны дублироваться в
любой программе, которая их использует.
     Можно модифицировать подпрограммы DLL, не делая повторно-
го связывания DLL с программой, которая их вызывает. Это отли-
чается от обычных объектных библиотек,  которые нужно повторно
связывать после модификации их подпрограмм.

          Файлы описания  ресурсов и файлы описания
                  ресурсов диалогового окна

     Файл описания ресурсов (.RC) содержит все  ресурсы  прог-
раммы в текстовом формате.  Файл описания ресурсов диалогового
окна (.DLG) содержит ресурсы только диалогового окна в тексто-
вом формате. Оба эти типа файлов могут генерироваться Resource
Toolkit или создаваться с помощью текстового редактора.
     .RC файлы  идентифицируют  ресурсы  по имени или номеру и
определяют их атрибуты, стили и другую информацию, относящуюся
к отдельным ресурсам.  Ниже показано как может выглядеть часть
содержания .RC файла,  который был сгенерирован редактором ме-
ню:
     CWMenus MENU
     BEGIN
       POPUR "&File"
         BEGIN
          MENUITEM "&New...\t^N",  CW_FILE_NEW
          MENUITEM "&Open...\t^O", CW_FILE_OPEN
          MENUITEM "&Save...\t^S", CW_FILE_SAVE
          MENUITEM "Save &As...", CW_FILE_SAVEAS
          MENUITEM "&Clip Chart...", CW_CLIP_CHART
          MENUITEM "&Print Charts\t^P", CW_FILE_PRINT
          MENUITEM "&Quit\t^X", CW_FILE_QUIT
          MENUITEM SEPARATOR
          MENUITEM "A&bout Borland...", CW_ABOUT_BORLAND
         END
     Ресурсы диалогового окна могут быть включены в .RC  файл,
используя .RC  include  предложение  или  могут вставляться в
.RC файл вручную.  Как показано ниже, .DLG файлы имеют формат,
совместимый с .RC файлами.
102 DIALOG  DISCARDABLE LOADONCALL PURE MOVEABLE 77,94,165,71,
STYLE WS_POPUR │ WS_CAPTION
BEGIN
  CONTROL "" 502, "EDIT", WS_CHILD │ WS_VISIBLE │ WS_TABSTOP │
0x80L,10, 32, 138, 12
  CONTROL "" 500, "STATIC", WS_CHILD │ WS_ VISIBLE │ WS_GROUP,
11, 5, 143, 18
  CONTROL "&OK"  1,  "BUTTON",   WS_CHILD   │   WS_VISIBLE   │
WS_NABSTOP │ 0x1L, 32, 50, 32, 14
  CONTROL "&Cancel"  2,  "BUTTON",  WS_CHILD  │  WS_VISIBLE  │
WS_TABSTOP, 99, 50, 32, 14
END
     .RC и  .DLG  файлы  полезны  для печатаемых архивов Ваших
ресурсов или для совместимости с  .RC  компилятором.  В  боль-
шинстве случаев они не являются необходимыми, так как Resource
Toolkit позволяет непосредственно редактировать  .EXE  и  .RES
файлы, исключая потребность в файлах описания ресурсов.

             Файлы растров, курсоров и пиктограмм

     Файлы растров (.BMP), курсоров (.CUR) и пиктограмм (.ICO)
хранятся  в растровом формате.  Каждый тип файла может  содер-
жать только один ресурс соответствующего типа.  Например, .CUR
файл может содержать только один  ресурс  курсора.  Также  как
.DLG файлы,  .BMP,  .CUR  и  .ICO  файлы  могут генерироваться
Resource Toolkit и они могут быть включены в .RC файл.

                       Файлы заголовков

     В Windows программах ресурсы  идентифицируются  номерами.
Например, множество  ресурсов диалогового окна в программе мо-
гут иметь уникальные идентификаторы 100,  101 и  102.  Windows
программы также  используют номера для идентификации действия,
являющегося результатом выбора из меню,  и  для  идентификации
отдельных управлений  внутри диалогового окна.  Типичная прог-
рамма может использовать сотни таких идентификаторов.
     Однако, номера ограничены по смыслу. Они представляют со-
бой бедные имена,  потому что все они выражают  последователь-
ность или величину.  По этой причине Windows разрешает исполь-
зовать  файлы  заголовков для   присваивания  символьных  имен
номерам, используемым  в программе.  Файл заголовков связывает
символы с номерами. Компилятор с языка и редактор ресурсов пе-
реводит символьное  имя обратно в идентифицирующий номер.  Это
позволяет работать со значащими именами,  а  не  с  бессвязным
списком номеров. Ниже приведена часть типичного файла заголов-
ков, совместимого с Resource Toolkit и с С (и С++).
     /* D:\TEST\CHART.H */
     #define CW_MENUS            999
     #define CW_FILE_NEW         501
     #define CW_FILE_OPEN        502
     #define CW_FILE_SAVE        503
     #define CW_FILE_SAVEAS      504
     #define CW_FILE_PRINT       505
     #define CW_FILE_QUIT        508
     #define CW_CLIP_CHART       509
     Редакторы акселераторов,  диалогового окна,  меню и строк
обеспечивают доступ к файлам заголовков и разрешает также соз-
давать или редактировать символьные имена, определенные в этих
файлах.




